// --- –ö–û–ú–ê–ù–î–ï–ù –¶–ï–ù–¢–ê–† 1312: CRYPTO & SECURITY ENGINE ---

// 1. SHA-256 HASH –§–£–ù–ö–¶–ò–à–ê –ó–ê –í–ï–†–ò–§–ò–ö–ê–¶–ò–à–ê
async function generateHash(text) {
    const msgUint8 = new TextEncoder().encode(text);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('').substring(0, 16);
}

// 2. –ë–õ–û–ö–ß–ï–à–ù –õ–û–ì–ò–ö–ê (–í–ï–†–£–í–ê–ä–ï –í–û –ò–ó–í–û–†–û–¢)
const newsLedger = []; 

async function vacuum(q) {
    const grid = document.getElementById('news-grid');
    grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:var(--gold); font-family:Orbitron;">
        <i class="fas fa-link fa-spin"></i> –°–ò–°–¢–ï–ú–û–¢ –ì–ï–ù–ï–†–ò–†–ê –ë–õ–û–ö–û–í–ò –ó–ê: ${q.toUpperCase()}...</div>`;
    
    const rssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(q)}&hl=mk&gl=MK&ceid=MK:mk`;
    const api = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}&api_key=oyzofskn0f0q0g0w0e0r0t0y0u0i0o0p0a0s0d0f`;

    try {
        const res = await fetch(api);
        const data = await res.json();
        
        if (data.status === 'ok') {
            let html = '';
            for (let item of data.items) {
                // –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ –•–ê–® –∑–∞ —Å–µ–∫–æ—ò–∞ –≤–µ—Å—Ç (Blockchain Integrity)
                const newsHash = await generateHash(item.title + item.pubDate);
                const blockId = Math.random().toString(36).substring(7).toUpperCase();
                
                newsLedger.push({block: blockId, hash: newsHash});

                html += `
                    <div class="card" onclick="window.open('${item.link}', '_blank')">
                        <div class="card-meta">üõ°Ô∏è –í–ï–†–ò–§–ò–ö–£–í–ê–ù–û | HASH: ${newsHash}</div>
                        <img src="https://picsum.photos/seed/${newsHash}/400/200">
                        <div class="card-body">
                            <div style="font-size:0.6rem; color:var(--shield-green); font-family:Orbitron;">
                                <i class="fas fa-cube"></i> BLOCK ID: ${blockId}
                            </div>
                            <div style="font-weight:bold; margin-top:5px;">${item.title.split(' - ')[0]}</div>
                            <div style="font-size:0.7rem; color:var(--gold); margin-top:10px;">
                                <i class="fas fa-check-double"></i> –ë–õ–û–ö–ß–ï–à–ù –°–¢–ê–¢–£–°: –ò–ú–£–¢–ê–ë–ò–õ–ù–û
                            </div>
                        </div>
                    </div>`;
            }
            grid.innerHTML = html;
        }
    } catch(e) { 
        grid.innerHTML = "<div style='color:red;'>SECURITY BREACH: –ù–µ—É—Å–ø–µ—à–Ω–æ –≤—à–º—É–∫—É–≤–∞—ö–µ.</div>"; 
    }
}

// 3. –ú–ï–°–ò–ù–è–ï–† –°–û –ï–ù–ö–†–ò–ü–¶–ò–à–ê (E2EE)
function sendMsg() {
    const input = document.getElementById('chat-input');
    const display = document.getElementById('chat-display');
    if(!input.value) return;

    // –°–∏–º—É–ª–∏—Ä–∞–º–µ –ï–Ω–∫—Ä–∏–ø—Ü–∏—ò–∞ (Base64 + Hash)
    const encrypted = btoa(input.value);
    const msgId = 'msg-' + Date.now();

    display.innerHTML += `
        <div class="msg sent" id="${msgId}" onclick="deleteMsg('${msgId}')">
            <small style="font-size:0.5rem; display:block;">[ENCRYPTED PAYLOAD: ${encrypted.substring(0,10)}...]</small>
            ${input.value}
            <span class="del-hint"><i class="fas fa-eraser"></i> –ò–∑–±—Ä–∏—à–∏ –æ–¥ —Å–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä–∏</span>
        </div>`;
    
    input.value = '';
    display.scrollTop = display.scrollHeight;
}

function deleteMsg(id) {
    if(confirm("–î–∞–ª–∏ —Å–∞–∫–∞—Ç–µ –¥–∞ –≥–æ —É–Ω–∏—à—Ç–∏—Ç–µ –æ–≤–æ—ò –ø–æ–¥–∞—Ç–æ—á–µ–Ω –±–ª–æ–∫ –∑–∞—Å–µ–∫–æ–≥–∞—à?")) {
        const el = document.getElementById(id);
        el.innerHTML = "<i><i class='fas fa-trash-restore'></i> –ë–ª–æ–∫–æ—Ç –µ —Ç—Ä–∞—ò–Ω–æ –¥–µ—Å—Ç—Ä—É–∫—Ç—É–∏—Ä–∞–Ω.</i>";
        el.style.background = "#400";
        el.style.color = "#ff4b2b";
    }
}

// –ü—Ä–≤–∏—á–Ω–æ –≤—á–∏—Ç—É–≤–∞—ö–µ
window.onload = () => {
    console.log("üõ°Ô∏è –°–ò–°–¢–ï–ú–û–¢ 1312 –ï –û–ù–õ–ê–à–ù. –ë–õ–û–ö–ß–ï–à–ù –ú–û–î–£–õ–û–¢ –ï –ü–û–î–ì–û–¢–í–ï–ù.");
    vacuum('Macedonia News');
};
